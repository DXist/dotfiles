#!/usr/bin/env bash
msg=$(cat $1)
prefix=""
timeglass=""

case $2 in
	message|template|'')
		BRANCH_NAME=`git rev-parse --abbrev-ref HEAD`
		ISSUE=`expr "$BRANCH_NAME" : '.*/\([[:upper:]]\+-[[:digit:]]\+\)'`

		hash glass 2>&1

		if [ "$ISSUE" -a $? = 0 ]; then
			prefix="$ISSUE "
			timeglass="$(glass -s status --template '{{printf "#time %0.0fm" .Minutes }}') "
		fi
		;;
esac

printf "${prefix}${timeglass}${msg}" > "$1"
