#!/usr/bin/env bash
msg=$(cat $1)
prefix=""
timeglass=""

case $2 in
	message|template|'')
		BRANCH_NAME=`git rev-parse --abbrev-ref HEAD`
		ISSUE=`expr "$BRANCH_NAME" : '.*/\([[:upper:]]\+-[[:digit:]]\+\)'`


		if [ "$ISSUE" ]; then
			prefix="$ISSUE "
		fi
		if hash glass 2>/dev/null; then
			timeglass="$(glass -s status --template '{{printf "#time %0.0fm" .Minutes }}') "
		fi
		;;
esac

printf "${prefix}${timeglass}${msg}" > "$1"
